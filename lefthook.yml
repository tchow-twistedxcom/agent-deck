# Local CI pipeline - runs lint, test, and build in parallel
# Called automatically on git push (via pre-push hook) or manually: make ci
#
# Usage:
#   make ci              Run full CI checks locally
#   lefthook run pre-push --force   Run directly (--force skips file-change check)

pre-push:
  parallel: true
  commands:
    lint:
      run: golangci-lint run
      tags: [quality]
    test:
      run: go test -race -count=1 ./...
      tags: [test]
    build:
      run: go build -o /dev/null ./cmd/agent-deck/
      tags: [build]

# Fast pre-commit checks (formatting only, keeps commits snappy)
pre-commit:
  parallel: true
  commands:
    fmt-check:
      run: test -z "$(gofmt -l .)" || (echo "Run 'go fmt ./...' to fix formatting" && gofmt -l . && exit 1)
      tags: [quality]
    vet:
      run: go vet ./...
      tags: [quality]
